/*! For license information please see 3658e2af8882d7847b10.js.LICENSE.txt */
function _regenerator(){var e,n,r="function"==typeof Symbol?Symbol:{},t=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,t,o,a){var c=t&&t.prototype instanceof u?t:u,f=Object.create(c.prototype);return _regeneratorDefine2(f,"_invoke",function(r,t,o){var a,u,c,f=0,l=o||[],s=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(n,r){return a=n,u=0,c=e,p.n=r,i}};function d(r,t){for(u=r,c=t,n=0;!s&&f&&!o&&n<l.length;n++){var o,a=l[n],d=p.p,g=a[2];r>3?(o=g===t)&&(c=a[(u=a[4])?5:(u=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=r<2&&d<a[1])?(u=0,p.v=t,p.n=a[1]):d<g&&(o=r<3||a[0]>t||t>g)&&(a[4]=r,a[5]=t,p.n=g,u=0))}if(o||r>1)return i;throw s=!0,t}return function(o,l,g){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&d(l,g),u=l,c=g;(n=u<2?e:c)||!s;){a||(u?u<3?(u>1&&(p.n=-1),d(u,c)):p.n=c:p.v=c);try{if(f=2,a){if(u||(o="next"),n=a[o]){if(!(n=n.call(a,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,u<2&&(u=0)}else 1===u&&(n=a.return)&&n.call(a),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);a=e}else if((n=(s=p.n<0)?c:r.call(t,p))!==i)break}catch(n){a=e,u=1,c=n}finally{f=1}}return{value:n,done:s}}}(r,o,a),!0),f}var i={};function u(){}function c(){}function f(){}n=Object.getPrototypeOf;var l=[][t]?n(n([][t]())):(_regeneratorDefine2(n={},t,function(){return this}),n),s=f.prototype=u.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(s),e}return c.prototype=f,_regeneratorDefine2(s,"constructor",f),_regeneratorDefine2(f,"constructor",c),c.displayName="GeneratorFunction",_regeneratorDefine2(f,o,"GeneratorFunction"),_regeneratorDefine2(s),_regeneratorDefine2(s,o,"Generator"),_regeneratorDefine2(s,t,function(){return this}),_regeneratorDefine2(s,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:p}})()}function _regeneratorDefine2(e,n,r,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}_regeneratorDefine2=function(e,n,r,t){function a(n,r){_regeneratorDefine2(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!t,configurable:!t,writable:!t}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},_regeneratorDefine2(e,n,r,t)}function asyncGeneratorStep(e,n,r,t,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void r(e)}u.done?n(c):Promise.resolve(c).then(t,o)}function _asyncToGenerator(e){return function(){var n=this,r=arguments;return new Promise(function(t,o){var a=e.apply(n,r);function i(e){asyncGeneratorStep(a,t,o,i,u,"next",e)}function u(e){asyncGeneratorStep(a,t,o,i,u,"throw",e)}i(void 0)})}}var fileInput=null,ColumnKeyName="";function UpgradeExcel(){return _UpgradeExcel.apply(this,arguments)}function _UpgradeExcel(){return _UpgradeExcel=_asyncToGenerator(_regenerator().m(function e(){var n,r,t,o;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(fileInput&&fileInput.files&&0!==fileInput.files.length){e.n=1;break}return console.error("Nessun file selezionato"),alert("Seleziona prima un file CSV"),e.a(2);case 1:return document.getElementById("run").disabled=!0,e.p=2,n=fileInput.files[0],e.n=3,ReadFile(n);case 3:return r=e.v,t=processCSV(r),e.n=4,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,o,a,i;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return r=n.workbook.worksheets.getActiveWorksheet(),(o=r.getUsedRange()).load("values"),e.n=1,n.sync();case 1:return a=o.values,a=findInExcel(t,a),(i=r.getRangeByIndexes(0,0,a.length,a[0].length)).values=a,e.n=2,formatColumns(a,r,n);case 2:return i.format.autofitColumns(),i.format.autofitRows(),e.n=3,n.sync();case 3:console.log("Importazione completata con successo!"),alert("Dati aggiornati con successo!");case 4:return e.a(2)}},e)}));return function(n){return e.apply(this,arguments)}}());case 4:e.n=6;break;case 5:e.p=5,o=e.v,console.error("Errore:",o),alert("Errore durante l'importazione: "+o.message);case 6:return e.p=6,document.getElementById("loading").style.display="none",document.getElementById("run").disabled=!1,e.f(6);case 7:return e.a(2)}},e,null,[[2,5,6,7]])})),_UpgradeExcel.apply(this,arguments)}function ReadFile(e){return new Promise(function(n,r){var t=new FileReader;t.onload=function(){return n(t.result)},t.onerror=r,t.readAsArrayBuffer(e)})}function TakeKeyColumn(e){if(!e||0===e.length)return[];for(var n=-1,r=0;r<e[0].length;r++)if("matricola"===String(e[0][r]).toLowerCase()){n=r;break}if(-1===n)for(var t=0;t<e[0].length;t++){for(var o=new Set,a=!0,i=1;i<e.length;i++){if(o.has(e[i][t])){a=!1;break}o.add(e[i][t])}if(a){n=t;break}}return-1===n?[]:n}function processCSV(e){return(new TextDecoder).decode(e).trim().split(/\r?\n/).map(function(e){var n=formatForSplitting(e),r=n.includes(";")?";":",";return n.split(r).map(cellFormat)})}function formatForSplitting(e){return e.replace(/"(\d+),(\d+)"/g,"$1.$2")}function cellFormat(e){if(e=e.trim(),/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}$/.test(e))return e;var n=e.toString(),r=Number(n);return isNaN(r)?n:r}function findInExcel(e,n){for(var r=TakeKeyColumn(e),t=TakeKeyColumn(n),o=e.slice(1).map(function(e){return e[r]}),a=n.slice(1).map(function(e){return e[t]}),i=0;i<o.length;i++){var u=a.indexOf(o[i]);if(-1!==u)for(var c=u+1,f=0;f<n[0].length;f++){var l=e[i+1][f];n[0][f].toLowerCase().includes("mese")&&(n[c][f]=l),f!==t&&("number"==typeof l&&"number"==typeof n[c][f]?n[c][f]+=l:n[c][f]!=l&&(n[c][f]=l))}}return n}function formatColumns(e,n,r){return _formatColumns.apply(this,arguments)}function _formatColumns(){return(_formatColumns=_asyncToGenerator(_regenerator().m(function e(n,r,t){var o,a,i,u,c,f;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:o=0;case 1:if(!(o<n[0].length)){e.n=7;break}n[0][o].toString().toLowerCase(),a=!1,i=!1,u=1;case 2:if(!(u<n.length)){e.n=5;break}if("string"!=typeof(c=n[u][o])||!/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}$/.test(c)){e.n=3;break}return a=!0,e.a(3,5);case 3:"number"!=typeof c||Number.isInteger(c)||(i=!0);case 4:u++,e.n=2;break;case 5:f=r.getRangeByIndexes(1,o,n.length-1,1),a?f.numberFormat=[["mmm-yyyy"]]:i&&(f.numberFormat=[["#,##0.00;[Red]-#,##0.00"]]);case 6:o++,e.n=1;break;case 7:return e.n=8,t.sync();case 8:return e.a(2)}},e)}))).apply(this,arguments)}Office.onReady(function(e){if(e.host===Office.HostType.Excel){document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",fileInput=document.getElementById("fileInput");var n=document.getElementById("run");fileInput.addEventListener("change",function(){fileInput.files&&fileInput.files.length>0&&(console.log("File selezionato:",fileInput.files[0].name),document.getElementById("fileName").textContent="Selected file: "+fileInput.files[0].name)}),n.addEventListener("click",UpgradeExcel)}});