/*! For license information please see f06b13ca417cd37aa147.js.LICENSE.txt */
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regeneratorValues(e){if(null!=e){var n=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(_typeof(e)+" is not iterable")}function _regenerator(){var e,n,r="function"==typeof Symbol?Symbol:{},t=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,t,o,a){var f=t&&t.prototype instanceof u?t:u,c=Object.create(f.prototype);return _regeneratorDefine2(c,"_invoke",function(r,t,o){var a,u,f,c=0,l=o||[],s=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(n,r){return a=n,u=0,f=e,p.n=r,i}};function g(r,t){for(u=r,f=t,n=0;!s&&c&&!o&&n<l.length;n++){var o,a=l[n],g=p.p,y=a[2];r>3?(o=y===t)&&(f=a[(u=a[4])?5:(u=3,3)],a[4]=a[5]=e):a[0]<=g&&((o=r<2&&g<a[1])?(u=0,p.v=t,p.n=a[1]):g<y&&(o=r<3||a[0]>t||t>y)&&(a[4]=r,a[5]=t,p.n=y,u=0))}if(o||r>1)return i;throw s=!0,t}return function(o,l,y){if(c>1)throw TypeError("Generator is already running");for(s&&1===l&&g(l,y),u=l,f=y;(n=u<2?e:f)||!s;){a||(u?u<3?(u>1&&(p.n=-1),g(u,f)):p.n=f:p.v=f);try{if(c=2,a){if(u||(o="next"),n=a[o]){if(!(n=n.call(a,f)))throw TypeError("iterator result is not an object");if(!n.done)return n;f=n.value,u<2&&(u=0)}else 1===u&&(n=a.return)&&n.call(a),u<2&&(f=TypeError("The iterator does not provide a '"+o+"' method"),u=1);a=e}else if((n=(s=p.n<0)?f:r.call(t,p))!==i)break}catch(n){a=e,u=1,f=n}finally{c=1}}return{value:n,done:s}}}(r,o,a),!0),c}var i={};function u(){}function f(){}function c(){}n=Object.getPrototypeOf;var l=[][t]?n(n([][t]())):(_regeneratorDefine2(n={},t,function(){return this}),n),s=c.prototype=u.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(s),e}return f.prototype=c,_regeneratorDefine2(s,"constructor",c),_regeneratorDefine2(c,"constructor",f),f.displayName="GeneratorFunction",_regeneratorDefine2(c,o,"GeneratorFunction"),_regeneratorDefine2(s),_regeneratorDefine2(s,o,"Generator"),_regeneratorDefine2(s,t,function(){return this}),_regeneratorDefine2(s,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:p}})()}function _regeneratorDefine2(e,n,r,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}_regeneratorDefine2=function(e,n,r,t){function a(n,r){_regeneratorDefine2(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!t,configurable:!t,writable:!t}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},_regeneratorDefine2(e,n,r,t)}function asyncGeneratorStep(e,n,r,t,o,a,i){try{var u=e[a](i),f=u.value}catch(e){return void r(e)}u.done?n(f):Promise.resolve(f).then(t,o)}function _asyncToGenerator(e){return function(){var n=this,r=arguments;return new Promise(function(t,o){var a=e.apply(n,r);function i(e){asyncGeneratorStep(a,t,o,i,u,"next",e)}function u(e){asyncGeneratorStep(a,t,o,i,u,"throw",e)}i(void 0)})}}var fileInput=null,ColumnKeyName="";function UpgradeExcel(){return _UpgradeExcel.apply(this,arguments)}function _UpgradeExcel(){return _UpgradeExcel=_asyncToGenerator(_regenerator().m(function e(){var n,r,t,o;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(fileInput&&fileInput.files&&0!==fileInput.files.length){e.n=1;break}return console.error("Nessun file selezionato"),alert("Seleziona prima un file CSV"),e.a(2);case 1:return document.getElementById("run").disabled=!0,e.p=2,n=fileInput.files[0],e.n=3,ReadFile(n);case 3:return r=e.v,t=processCSV(r),e.n=4,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,o,a,i;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return r=n.workbook.worksheets.getActiveWorksheet(),(o=r.getUsedRange()).load("values"),e.n=1,n.sync();case 1:return a=o.values,a=findInExcel(t,a),(i=r.getRangeByIndexes(0,0,a.length,a[0].length)).values=a,e.n=2,formatColumns(a,r,n,t);case 2:return i.format.autofitColumns(),i.format.autofitRows(),e.n=3,n.sync();case 3:console.log("Importazione completata con successo!"),alert("Dati aggiornati con successo!");case 4:return e.a(2)}},e)}));return function(n){return e.apply(this,arguments)}}());case 4:e.n=6;break;case 5:e.p=5,o=e.v,console.error("Errore:",o),alert("Errore durante l'importazione: "+o.message);case 6:return e.p=6,document.getElementById("loading").style.display="none",document.getElementById("run").disabled=!1,e.f(6);case 7:return e.a(2)}},e,null,[[2,5,6,7]])})),_UpgradeExcel.apply(this,arguments)}function ReadFile(e){return new Promise(function(n,r){var t=new FileReader;t.onload=function(){return n(t.result)},t.onerror=r,t.readAsArrayBuffer(e)})}function TakeKeyColumn(e){if(!e||0===e.length)return[];for(var n=-1,r=0;r<e[0].length;r++)if("matricola"===String(e[0][r]).toLowerCase()){n=r;break}if(-1===n)for(var t=0;t<e[0].length;t++){for(var o=new Set,a=!0,i=1;i<e.length;i++){if(o.has(e[i][t])){a=!1;break}o.add(e[i][t])}if(a){n=t;break}}return-1===n?[]:n}function processCSV(e){return(new TextDecoder).decode(e).trim().split(/\r?\n/).map(function(e){var n=formatForSplitting(e),r=n.includes(";")?";":",";return n.split(r).map(cellFormat)})}function formatForSplitting(e){return e.replace(/"(\d+),(\d+)"/g,"$1.$2")}function cellFormat(e){if(e=e.trim(),/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}$/.test(e))return e;var n=e.toString(),r=Number(n);return isNaN(r)?n:r}function findInExcel(e,n){for(var r=TakeKeyColumn(e),t=TakeKeyColumn(n),o=e.slice(1).map(function(e){return e[r]}),a=n.slice(1).map(function(e){return e[t]}),i=0;i<o.length;i++){var u=a.indexOf(o[i]);if(-1!==u)for(var f=u+1,c=0;c<n[0].length;c++){var l=e[i+1][c],s=n[0][c];(s.toLowerCase().includes("mese")||s.toLowerCase().includes("data"))&&(n[f][c]=l),c!==t&&("number"==typeof l&&"number"==typeof n[f][c]?n[f][c]+=l:n[f][c]!=l&&(n[f][c]=l))}}return n}function formatColumns(e,n,r,t){return _formatColumns.apply(this,arguments)}function _formatColumns(){return(_formatColumns=_asyncToGenerator(_regenerator().m(function e(n,r,t,o){var a,i;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:a=_regenerator().m(function e(t){var a,i,u,f,c,l,s;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:n[0][t].toString().toLowerCase(),a=!1,i=!1,u=1;case 1:if(!(u<n.length)){e.n=4;break}if("number"!=typeof(f=n[u][t])||Number.isInteger(f)){e.n=2;break}i=!0,e.n=3;break;case 2:if("string"!=typeof f||!/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}$/.test(f)){e.n=3;break}return a=!0,e.a(3,4);case 3:u++,e.n=1;break;case 4:if(c=r.getRangeByIndexes(1,t,n.length-1,1),i)c.numberFormat=[["#,##0.00;[Red]-#,##0.00"]];else if(a){for(l=o[1][t],s=1;s<n.length;s++)n[s][t]=l;c.values=n.slice(1).map(function(e){return[e[t]]}),c.numberFormat=[["@"]]}case 5:return e.a(2)}},e)}),i=0;case 1:if(!(i<n[0].length)){e.n=3;break}return e.d(_regeneratorValues(a(i)),2);case 2:i++,e.n=1;break;case 3:return e.n=4,t.sync();case 4:return e.a(2)}},e)}))).apply(this,arguments)}Office.onReady(function(e){if(e.host===Office.HostType.Excel){document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",fileInput=document.getElementById("fileInput");var n=document.getElementById("run");fileInput.addEventListener("change",function(){fileInput.files&&fileInput.files.length>0&&(console.log("File selezionato:",fileInput.files[0].name),document.getElementById("fileName").textContent="Selected file: "+fileInput.files[0].name)}),n.addEventListener("click",UpgradeExcel)}});